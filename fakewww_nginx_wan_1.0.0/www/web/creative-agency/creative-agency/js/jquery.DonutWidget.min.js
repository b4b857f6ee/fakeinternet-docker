var DonutWidget=function(t,e){if(t&&t instanceof jQuery)if($(t).length>1)for(var a=0;a<$(t).length;a++)this.init(t[a],e);else this.init(t,e)};DonutWidget.defaults={max:100,value:0,text:"",rotate:0,caption:"",colors:{primary:"#ffe600",background:"#eee"},size:"normal"},DonutWidget.instances=0,DonutWidget.prototype={constructor:DonutWidget,init:function(t,e){return this.options=$.extend({},DonutWidget.defaults,e),this.$element=$(t),this.$element.attr("data-chart-instance")?this.instanceID=this.$element.attr("data-chart-instance"):(DonutWidget.instances++,this.instanceID=DonutWidget.instances),this.paint(),this},paint:function(){var t=['<div class="donut-hole"><span class="donut-filling"></div>','<div class="donut-bite" data-segment-index="0"></div>','<div class="donut-bite" data-segment-index="1"></div>','<div class="donut-caption-wrapper"><span class="donut-caption"></span></div>'].join("");this.$element.html(t),this.$element.hasClass("donut-widget")||this.$element.addClass("donut-widget"),this.$element.addClass(this.options.size),this.$element.attr("data-chart-instance",this.instanceID),this.setSegments(),this.setPoints(),this.setText(),this.setAttributes()},setSegments:function(){this.segments={0:["0",this.options.value,this.options.colors.primary],1:[this.options.value,this.options.max-this.options.value,this.options.colors.background]}},setPoints:function(){for(var t=0;t<Object.keys(this.segments).length;t++){var e=this.segments[t];this.points={};var a=e[0]/this.options.max*360+this.options.rotate,i=e[1]/this.options.max*360;this.$element.find(".donut-bite.large").length||(e[1]>=this.options.max/2?this.$element.find(".donut-bite[data-segment-index='0']").addClass("large"):this.$element.find(".donut-bite[data-segment-index='1']").addClass("large")),this.setStyle(a,i,e,t)}},setStyle:function(t,e,a,i){$("#dynamic").length||$("<style type='text/css' id='dynamic' />").appendTo("head");var n=".donut-widget[data-chart-instance='"+this.instanceID+"']";this.$element.attr("id")&&(n="#"+this.$element.attr("id")),this.selector=n,this.removeStyle(i);var s=$("#dynamic").text()+"/*Style for "+this.instanceID+"_"+i+"*/"+n+' .donut-bite[data-segment-index="'+i+'"]{-moz-transform:rotate('+t+"deg);-ms-transform:rotate("+t+"deg);-webkit-transform:rotate("+t+"deg);-o-transform:rotate("+t+"deg);transform:rotate("+t+"deg);}"+n+' .donut-bite[data-segment-index="'+i+'"]:BEFORE{-moz-transform:rotate('+e+"deg);-ms-transform:rotate("+e+"deg);-webkit-transform:rotate("+e+"deg);-o-transform:rotate("+e+"deg);transform:rotate("+e+"deg); background-color: "+a[2]+";}"+n+' .donut-bite[data-segment-index="'+i+'"]:BEFORE{ background-color: '+a[2]+";}"+n+' .donut-bite[data-segment-index="'+i+'"].large:AFTER{ background-color: '+a[2]+";}";s+="/*Style End for "+this.instanceID+"_"+i+"*/",$("#dynamic").text(s)},removeStyle:function(t){var e=$("#dynamic").text(),a=e.split("/*Style for "+this.instanceID+"_"+t+"*/");if(1!=a.length){var i=a[0],n=a[1].split("/*Style End for "+this.instanceID+"_"+t+"*/")[1];$(dynamic).text(i+n)}},setText:function(){this.options.text||(this.options.text=Math.round(this.options.value/this.options.max*100)+"%"),this.$element.find(".donut-filling").text(this.options.text),this.$element.find(".donut-caption").text(this.options.caption)},setAttributes:function(){this.$element.attr("data-chart-max",this.options.max),this.$element.attr("data-chart-value",this.options.value),this.$element.attr("data-chart-text",this.options.text),this.$element.attr("data-chart-rotate",this.options.rotate),this.$element.attr("data-chart-caption",this.options.caption),this.$element.attr("data-chart-primary",this.options.colors.primary),this.$element.attr("data-chart-background",this.options.colors.background),this.$element.attr("data-chart-size",this.options.size)},redraw:function(t){return this.init(this.$element,$.extend({},this.options,t))}},DonutWidget.draw=function(t,e){t||(t=$(".donut-widget"));for(var a=[],i=0;i<t.length;i++){var n={};$(t[i]).data("chart-max")&&(n.max=$(t[i]).data("chart-max")),$(t[i]).data("chart-value")&&(n.value=$(t[i]).data("chart-value")),$(t[i]).data("chart-text")&&(n.text=$(t[i]).data("chart-text")),$(t[i]).data("chart-rotate")&&(n.rotate=$(t[i]).data("chart-rotate")),$(t[i]).data("chart-caption")&&(n.caption=$(t[i]).data("chart-caption")),$(t[i]).data("chart-primary")&&(n.colors=n.colors||{},n.colors.primary=$(t[i]).data("chart-primary")),$(t[i]).data("chart-background")&&(n.colors=n.colors||{},n.colors.background=$(t[i]).data("chart-background")),$(t[i]).data("chart-size")&&(n.size=$(t[i]).data("chart-size")),a.push(new DonutWidget($(t[i]),$.extend(n,e)))}return 1==a.length&&(a=a[0]),a},DonutWidget.redraw=function(t,e){return DonutWidget.draw(t,e)},$.fn.DonutWidget=function(t){return this.each(function(){var e=$(this),a=e.data("$donut"),i=null;i=a?$.extend({},a.options,t):"object"==typeof t&&t,e.donut=a,e.data("$donut",a=new DonutWidget($(this),i))})},$.fn.DonutWidget.Constructor=DonutWidget;